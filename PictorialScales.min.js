function Arrow(canvas,element,configuration){this.canvas=document.getElementById(canvas);this.element=document.getElementById(element);this.defaultConfiguration={fuzzyPartition:[{bounds:[0,0,15,50],color:[255,0,0],label:"U"},{bounds:[15,50,55,90],color:[255,255,0],label:"N"},{bounds:[55,90,100,100],color:[0,255,0],label:"S"}],colorPrototypes:[{label:"U",prototype:[255,0,0]},{label:"N",prototype:[255,255,0]},{label:"S",prototype:[0,255,0]}],anglePrototypes:[{label:"U",prototype:-40},{label:"N",prototype:0},{label:"S",prototype:40}],options:{impreciseInput:false,arrowThickness:12,arrowLength:95,canvasFuzzyHeight:150,canvasFuzzyWidth:400}};this.configurationManager=new ConfigurationManager(this,configuration);this.draw=function(xFuzzy,canvas){var size=canvas.width;var context=canvas.getContext("2d");var configuration=this.configurationManager.configuration;var color=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.colorPrototypes);var angle=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.anglePrototypes);context.clearRect(0,0,size,size);var arrowLength=configuration.options.arrowLength;var arrowThickness=configuration.options.arrowThickness;var u=arrowThickness;var v=size/2;var theta=-angle*Math.PI/180;context.beginPath();context.save();context.rotate(theta);context.translate(v*Math.sin(theta)+u*Math.cos(theta),v*Math.cos(theta)-u*Math.sin(theta)-size/2);context.fillStyle="rgb("+Math.round(color[0])+","+Math.round(color[1])+","+Math.round(color[2])+")";context.moveTo(u,v);context.lineTo(u,v-configuration.options.arrowThickness);context.lineTo(u+arrowLength-2*arrowThickness,size/2-arrowThickness);context.lineTo(u+arrowLength-2*arrowThickness,size/2-2*arrowThickness);context.lineTo(u+arrowLength,size/2);context.lineTo(u+arrowLength-2*arrowThickness,size/2+2*arrowThickness);context.lineTo(u+arrowLength-2*arrowThickness,size/2+arrowThickness);context.lineTo(u,size/2+arrowThickness);context.closePath();context.fill();context.restore();context.stroke()}}function SunCloud(canvas,element,configuration){this.canvas=document.getElementById(canvas);this.element=document.getElementById(element);this.defaultConfiguration={fuzzyPartition:[{bounds:[0,0,0,25],color:[255,0,0],label:"VL"},{bounds:[0,25,25,50],color:[255,128,0],label:"L"},{bounds:[25,50,50,75],color:[255,255,0],label:"N"},{bounds:[50,75,75,100],color:[128,255,0],label:"R"},{bounds:[75,100,100,100],color:[0,255,0],label:"VR"}],sunSizePrototypes:[{label:"VL",prototype:0},{label:"L",prototype:0},{label:"N",prototype:30},{label:"R",prototype:35},{label:"VR",prototype:40}],sunPositionPrototypes:[{label:"VL",prototype:[0,0]},{label:"L",prototype:[0,0]},{label:"N",prototype:[0,0]},{label:"R",prototype:[0,0]},{label:"VR",prototype:[0,0]}],sunColorPrototypes:[{label:"VL",prototype:[255,255,255]},{label:"L",prototype:[255,128,0]},{label:"N",prototype:[204,204,0]},{label:"R",prototype:[230,230,0]},{label:"VR",prototype:[255,255,0]}],sunraySizePrototypes:[{label:"VL",prototype:0},{label:"L",prototype:0},{label:"N",prototype:.8},{label:"R",prototype:1},{label:"VR",prototype:1.3}],cloudSizePrototypes:[{label:"VL",prototype:1.3},{label:"L",prototype:1},{label:"N",prototype:.8},{label:"R",prototype:0},{label:"VR",prototype:0}],cloudPositionPrototypes:[{label:"VL",prototype:[-50,0]},{label:"L",prototype:[-15,0]},{label:"N",prototype:[0,0]},{label:"R",prototype:[5,0]},{label:"VR",prototype:[5,0]}],cloudColorPrototypes:[{label:"VL",prototype:[25,25,25]},{label:"L",prototype:[127,127,127]},{label:"N",prototype:[192,192,192]},{label:"R",prototype:[255,255,255]},{label:"VR",prototype:[255,255,255]}],rainLevelPrototypes:[{label:"VL",prototype:10},{label:"L",prototype:7},{label:"N",prototype:0},{label:"R",prototype:0},{label:"VR",prototype:0}],options:{impreciseInput:false,canvasFuzzyHeight:150,canvasFuzzyWidth:400}};this.configurationManager=new ConfigurationManager(this,configuration);this.draw=function(xFuzzy,canvas){var size=canvas.width;var context=canvas.getContext("2d");var configuration=this.configurationManager.configuration;var sunSize=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.sunSizePrototypes);var sunPosition=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.sunPositionPrototypes);var sunColor=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.sunColorPrototypes);var sunraySize=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.sunraySizePrototypes);var cloudSize=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.cloudSizePrototypes);var cloudPosition=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.cloudPositionPrototypes);var cloudColor=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.cloudColorPrototypes);var rainLevel=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.rainLevelPrototypes);context.clearRect(0,0,size,size);if(sunSize>0){context.save();context.beginPath();context.strokeStyle="rgb("+Math.round(sunColor[0])+","+Math.round(sunColor[1])+","+Math.round(sunColor[2])+")";for(var i=0;i<12;i++){context.moveTo(sunPosition[0]+size/2+sunSize*Math.cos(i*Math.PI/6),sunPosition[1]+size/2+sunSize*Math.sin(i*Math.PI/6));context.lineTo(sunPosition[0]+size/2+sunSize*(1+sunraySize)*Math.cos(i*Math.PI/6),sunPosition[1]+size/2+sunSize*(1+sunraySize)*Math.sin(i*Math.PI/6));context.stroke()}context.closePath();context.restore();context.beginPath();context.fillStyle="rgb("+Math.round(sunColor[0])+","+Math.round(sunColor[1])+","+Math.round(sunColor[2])+")";context.arc(sunPosition[0]+size/2,sunPosition[1]+size/2,sunSize,0,Math.PI*2,true);context.fill();context.stroke();context.closePath()}if(cloudSize>0){var circle1=[cloudPosition[0]+size/2,cloudPosition[1]+size/2,10*cloudSize];var circle2=[circle1[0]+20*cloudSize,circle1[1]-8*cloudSize,20*cloudSize];var circle3=[circle2[0]+24*cloudSize,circle1[1]-12*cloudSize,30*cloudSize];var circle4=[circle3[0]+24*cloudSize,circle1[1]-6*cloudSize,16*cloudSize];var p1=this.circleIntersection(circle1,circle2,-1);var p2=this.circleIntersection(circle2,circle3,-1);var p3=this.circleIntersection(circle3,circle4,1);context.save();context.fillStyle="rgb("+Math.round(cloudColor[0])+","+Math.round(cloudColor[1])+","+Math.round(cloudColor[2])+")";context.beginPath();context.arc(circle1[0],circle1[1],circle1[2],Math.PI/2,3*Math.PI/2,false);var theta1=Math.atan2(p1[1]-circle2[1],p1[0]-circle2[0]);var theta2=Math.atan2(p2[1]-circle2[1],p2[0]-circle2[0]);context.arc(circle2[0],circle2[1],circle2[2],theta1,theta2,false);var theta1=Math.atan2(p2[1]-circle3[1],p2[0]-circle3[0]);var theta2=Math.atan2(p3[1]-circle3[1],p3[0]-circle3[0]);context.arc(circle3[0],circle3[1],circle3[2],theta1,theta2,false);var theta1=Math.atan2(p3[1]-circle4[1],p3[0]-circle4[0]);var theta2=Math.PI/2;context.arc(circle4[0],circle4[1],circle4[2],theta1,theta2,false);context.closePath();context.fill();context.stroke();context.restore();if(rainLevel>1){context.save();context.strokeStyle="rgb("+Math.round(cloudColor[0])+","+Math.round(cloudColor[1])+","+Math.round(cloudColor[2])+")";var deltaX=Math.round((circle4[0]-circle1[0])/(rainLevel-1));for(var i=0;i<Math.round(rainLevel);i++){context.moveTo(circle1[0]+deltaX*i,circle1[1]+circle1[2]);context.lineTo(circle1[0]+deltaX*i+5*cloudSize,circle1[1]+circle1[2]+5*cloudSize);context.stroke()}context.restore()}}};this.circleIntersection=function(circle1,circle2,sign){var q=(circle2[0]-circle1[0])/(circle2[1]-circle1[1]);var N=(circle1[2]*circle1[2]-circle2[2]*circle2[2]-circle1[0]*circle1[0]+circle2[0]*circle2[0]-circle1[1]*circle1[1]+circle2[1]*circle2[1])/(2*(circle2[1]-circle1[1]));var A=q*q+1;var B=2*circle2[1]*q-2*N*q-2*circle2[0];var C=circle2[0]*circle2[0]+circle2[1]*circle2[1]+N*N-circle2[2]*circle2[2]-2*circle2[1]*N;var delta=Math.sqrt(B*B-4*A*C);var x=(-B+sign*delta)/(2*A);var y=N-x*q;return[x,y]}}function Emoticon(canvas,element,configuration){this.canvas=document.getElementById(canvas);this.element=document.getElementById(element);this.defaultConfiguration={fuzzyPartition:[{bounds:[0,0,15,50],color:[255,0,0],label:"U"},{bounds:[15,50,55,90],color:[255,255,0],label:"N"},{bounds:[55,90,100,100],color:[0,255,0],label:"S"}],colorPrototypes:[{label:"U",prototype:[255,0,0]},{label:"N",prototype:[255,255,0]},{label:"S",prototype:[0,255,0]}],gradientPrototypes:[{label:"U",prototype:0},{label:"N",prototype:.3*this.canvas.height},{label:"S",prototype:.9*this.canvas.height}],smilePrototypes:[{label:"U",prototype:-.5},{label:"N",prototype:0},{label:"S",prototype:1}],secondSmilePrototypes:[{label:"U",prototype:-.5},{label:"N",prototype:0},{label:"S",prototype:1}],eyesSizePrototypes:[{label:"U",prototype:1},{label:"N",prototype:1},{label:"S",prototype:1}],eyebrowsPrototypes:[{label:"U",prototype:.33},{label:"N",prototype:.35},{label:"S",prototype:.38}],options:{impreciseInput:false,eyeWidthToSizeRatio:.08,eyeHeightToWidthRatio:1.5,eyeXPositionToSizeRatio:.2,eyeYPositionToSizeRatio:.1,eyesFillColor:"black",eyesSizeScaled:false,eyebrows:false,leftEyeBrowLeftYPositionToSizeRatio:.25,leftEyeBrowRightYPositionToSizeRatio:.3,mouthLengthToSizeRatio:.55,mouthYPositionToSizeRatio:.2,mouthFill:false,mouthFillColor:"black",smileToSizeRatio:.3,secondSmile:false,smileCurve:"quadratic",secondSmileCurve:"quadratic",gradient:false,gradientColorBegin:"#0752DE",gradientColorEnd:"yellow",canvasFuzzyHeight:150,canvasFuzzyWidth:400}};this.configurationManager=new ConfigurationManager(this,configuration);this.draw=function(xFuzzy,canvas){var size=canvas.width;var context=canvas.getContext("2d");var configuration=this.configurationManager.configuration;var color=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.colorPrototypes);var smile=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.smilePrototypes);var secondSmile=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.secondSmilePrototypes);var eyesSize=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.eyesSizePrototypes);var gradientValue=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.gradientPrototypes);var eyebrows=this.configurationManager.fuzzy.defuzzify(xFuzzy,configuration.eyebrowsPrototypes);var gradient=context.createLinearGradient(0,0,0,gradientValue);gradient.addColorStop(0,configuration.options.gradientColorBegin);gradient.addColorStop(1,configuration.options.gradientColorEnd);context.beginPath();context.fillStyle="rgb("+Math.round(color[0])+","+Math.round(color[1])+","+Math.round(color[2])+")";if(configuration.options.gradient&&gradientValue>0){context.fillStyle=gradient}context.arc(size/2,size/2,size/2,0,Math.PI*2,true);context.fill();context.closePath();context.beginPath();context.moveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));if(configuration.options.smileCurve=="cubic"){context.bezierCurveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smile),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smile),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio))}else{context.quadraticCurveTo(size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smile),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio))}if(configuration.options.mouthFill){context.fillStyle=configuration.options.mouthFillColor}context.fill();context.stroke();context.closePath();if(configuration.options.secondSmile){context.beginPath();context.moveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));if(configuration.options.secondSmileCurve=="cubic"){context.bezierCurveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmile),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmile),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio))}else{context.quadraticCurveTo(size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmile),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio))}if(configuration.options.mouthFill){context.fillStyle=configuration.options.mouthFillColor}context.fill();context.stroke();context.closePath()}if(configuration.options.eyebrows){context.save();context.beginPath();context.lineWidth=2;context.moveTo(size/2-(configuration.options.eyeXPositionToSizeRatio+configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowLeftYPositionToSizeRatio*size);context.quadraticCurveTo(size/2-configuration.options.eyeXPositionToSizeRatio*size,size/2-eyebrows*size,size/2-(configuration.options.eyeXPositionToSizeRatio-configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowRightYPositionToSizeRatio*size);context.stroke();context.closePath();context.beginPath();context.moveTo(size/2+(configuration.options.eyeXPositionToSizeRatio+configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowLeftYPositionToSizeRatio*size);context.quadraticCurveTo(size/2+configuration.options.eyeXPositionToSizeRatio*size,size/2-eyebrows*size,size/2+(configuration.options.eyeXPositionToSizeRatio-configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowRightYPositionToSizeRatio*size);context.stroke();context.closePath();context.restore()}context.beginPath();context.moveTo(size/2-configuration.options.eyeXPositionToSizeRatio*size,size/2-configuration.options.eyeYPositionToSizeRatio*size);context.closePath();context.save();context.fillStyle=configuration.options.eyesFillColor;scaleWidth=1;scaleHeight=eyesSize*configuration.options.eyeHeightToWidthRatio;if(configuration.options.eyesSizeScaled){scaleWidth=eyesSize}context.scale(scaleWidth,scaleHeight);context.arc((size/2-configuration.options.eyeXPositionToSizeRatio*size)/scaleWidth,(size/2-configuration.options.eyeYPositionToSizeRatio*size)/scaleHeight,configuration.options.eyeWidthToSizeRatio*size,0,Math.PI*2,true);context.fill();context.restore();context.beginPath();context.moveTo(size/2+configuration.options.eyeXPositionToSizeRatio*size,size/2-configuration.options.eyeYPositionToSizeRatio*size);context.closePath();context.save();context.fillStyle=configuration.options.eyesFillColor;scaleWidth=1;scaleHeight=eyesSize*configuration.options.eyeHeightToWidthRatio;if(configuration.options.eyesSizeScaled){scaleWidth=eyesSize}context.scale(scaleWidth,scaleHeight);context.arc((size/2+configuration.options.eyeXPositionToSizeRatio*size)/scaleWidth,(size/2-configuration.options.eyeYPositionToSizeRatio*size)/scaleHeight,configuration.options.eyeWidthToSizeRatio*size,0,Math.PI*2,true);context.fill();context.restore()}}function BiEmoticon(canvas,element,configuration){this.canvas=document.getElementById(canvas);this.element=document.getElementById(element);this.defaultConfiguration={fuzzyPartition:[{bounds:[0,0,15,50],color:[255,0,0],label:"U"},{bounds:[15,50,55,90],color:[255,255,0],label:"N"},{bounds:[55,90,100,100],color:[0,255,0],label:"S"}],colorPrototypes:[{label:"U",prototype:[255,0,0]},{label:"N",prototype:[255,255,0]},{label:"S",prototype:[0,255,0]}],gradientPrototypes:[{label:"U",prototype:0},{label:"N",prototype:.3*this.canvas.height},{label:"S",prototype:.9*this.canvas.height}],smilePrototypes:[{label:"U",prototype:-.5},{label:"N",prototype:0},{label:"S",prototype:1}],secondSmilePrototypes:[{label:"U",prototype:-.5},{label:"N",prototype:0},{label:"S",prototype:1}],eyesSizePrototypes:[{label:"U",prototype:1},{label:"N",prototype:1},{label:"S",prototype:1}],eyebrowsPrototypes:[{label:"U",prototype:.33},{label:"N",prototype:.35},{label:"S",prototype:.38}],options:{impreciseInput:false,eyeWidthToSizeRatio:.08,eyeHeightToWidthRatio:1.5,eyeXPositionToSizeRatio:.2,eyeYPositionToSizeRatio:.1,eyesFillColor:"black",eyesSizeScaled:false,eyebrows:false,leftEyeBrowLeftYPositionToSizeRatio:.25,leftEyeBrowRightYPositionToSizeRatio:.3,mouthLengthToSizeRatio:.55,mouthYPositionToSizeRatio:.2,smileToSizeRatio:.2,secondSmile:false,gradient:false,gradientColorBegin:"#0752DE",gradientColorEnd:"yellow",sliderThumbWidth:10,canvasFuzzyHeight:160,canvasFuzzyWidth:400}};this.sliderThumbWidth=0;this.leftStartAngle=0;this.leftEndAngle=2*Math.PI;this.rightStartAngle=Math.PI/2;this.rightEndAngle=-Math.PI/2;this.dashSize=3;this.rightButtonDown=false;this.configurationManager=new ConfigurationManager(this,configuration);this.render=function(){var xFuzzy=this.configurationManager.fuzzy.fuzzyInputProcessing();this.draw(xFuzzy,this.canvas);if(this.configurationManager.fuzzy.canvasFuzzy!==null){this.configurationManager.fuzzy.drawFuzzyPartition()}};this.draw=function(xFuzzy){var size=this.canvas.width;var context=this.canvas.getContext("2d");var configuration=this.configurationManager.configuration;var colorLower=this.configurationManager.fuzzy.defuzzify(xFuzzy[0],configuration.colorPrototypes);var smileLower=this.configurationManager.fuzzy.defuzzify(xFuzzy[0],configuration.smilePrototypes);var secondSmileLower=this.configurationManager.fuzzy.defuzzify(xFuzzy[0],configuration.secondSmilePrototypes);var eyesSizeLower=this.configurationManager.fuzzy.defuzzify(xFuzzy[0],configuration.eyesSizePrototypes);var gradientValueLower=this.configurationManager.fuzzy.defuzzify(xFuzzy[0],configuration.gradientPrototypes);var eyebrowsLower=this.configurationManager.fuzzy.defuzzify(xFuzzy[0],configuration.eyebrowsPrototypes);var colorUpper=this.configurationManager.fuzzy.defuzzify(xFuzzy[1],configuration.colorPrototypes);var smileUpper=this.configurationManager.fuzzy.defuzzify(xFuzzy[1],configuration.smilePrototypes);var secondSmileUpper=this.configurationManager.fuzzy.defuzzify(xFuzzy[1],configuration.secondSmilePrototypes);var eyesSizeUpper=this.configurationManager.fuzzy.defuzzify(xFuzzy[1],configuration.eyesSizePrototypes);var gradientValueUpper=this.configurationManager.fuzzy.defuzzify(xFuzzy[1],configuration.gradientPrototypes);var eyebrowsUpper=this.configurationManager.fuzzy.defuzzify(xFuzzy[1],configuration.eyebrowsPrototypes);var gradientLower=context.createLinearGradient(0,0,0,gradientValueLower);gradientLower.addColorStop(0,configuration.options.gradientColorBegin);gradientLower.addColorStop(1,configuration.options.gradientColorEnd);var gradientUpper=context.createLinearGradient(0,0,0,gradientValueUpper);gradientUpper.addColorStop(0,configuration.options.gradientColorBegin);gradientUpper.addColorStop(1,configuration.options.gradientColorEnd);context.beginPath();context.fillStyle="rgb("+Math.round(colorLower[0])+","+Math.round(colorLower[1])+","+Math.round(colorLower[2])+")";if(configuration.options.gradient&&gradientValueLower>0){context.fillStyle=gradientLower}context.arc(size/2,size/2,size/2,this.leftStartAngle,this.leftEndAngle,false);context.fill();context.closePath();context.beginPath();context.fillStyle="rgb("+Math.round(colorUpper[0])+","+Math.round(colorUpper[1])+","+Math.round(colorUpper[2])+")";if(configuration.options.gradient&&gradientValueUpper>0){context.fillStyle=gradientUpper}context.arc(size/2,size/2,size/2,this.rightStartAngle,this.rightEndAngle,true);context.fill();context.closePath();if(this.leftEndAngle!=0){context.beginPath();context.moveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.closePath();context.quadraticCurveTo(size*(1.2-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileLower),size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileLower));context.stroke();context.beginPath();context.moveTo(size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileLower));context.closePath();context.save();context.setLineDash([this.dashSize,this.dashSize]);context.quadraticCurveTo(size*(.8+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileLower),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.stroke();if(configuration.options.secondSmile){context.beginPath();context.moveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.closePath();context.quadraticCurveTo(size*(1.2-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileLower),size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileLower));context.stroke();context.beginPath();context.moveTo(size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileLower));context.closePath();context.save();context.setLineDash([this.dashSize,this.dashSize]);context.quadraticCurveTo(size*(.8+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileLower),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.stroke();context.restore()}}if(this.rightEndAngle!=0){context.beginPath();context.moveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.closePath();context.quadraticCurveTo(size*(1.2-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileUpper),size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileUpper));context.stroke();context.restore();context.beginPath();context.moveTo(size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileUpper));context.closePath();context.quadraticCurveTo(size*(.8+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*smileUpper),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.stroke();if(configuration.options.secondSmile){context.beginPath();context.moveTo(size*(1-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.closePath();context.quadraticCurveTo(size*(1.2-configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileUpper),size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileUpper));context.stroke();context.restore();context.beginPath();context.moveTo(size/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileUpper));context.closePath();context.quadraticCurveTo(size*(.8+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio+configuration.options.smileToSizeRatio*secondSmileUpper),size*(1+configuration.options.mouthLengthToSizeRatio)/2,size*(1/2+configuration.options.mouthYPositionToSizeRatio));context.stroke();context.restore()}}if(this.leftEndAngle==0){eyebrowsLower=eyebrowsUpper}if(this.rightEndAngle==0){eyebrowsUpper=eyebrowsLower}if(configuration.options.eyebrows){context.save();context.beginPath();context.lineWidth=2;context.moveTo(size/2-(configuration.options.eyeXPositionToSizeRatio+configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowLeftYPositionToSizeRatio*size);context.quadraticCurveTo(size/2-configuration.options.eyeXPositionToSizeRatio*size,size/2-eyebrowsLower*size,size/2-(configuration.options.eyeXPositionToSizeRatio-configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowRightYPositionToSizeRatio*size);context.stroke();context.closePath();context.beginPath();context.moveTo(size/2+(configuration.options.eyeXPositionToSizeRatio+configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowLeftYPositionToSizeRatio*size);context.quadraticCurveTo(size/2+configuration.options.eyeXPositionToSizeRatio*size,size/2-eyebrowsUpper*size,size/2+(configuration.options.eyeXPositionToSizeRatio-configuration.options.eyeWidthToSizeRatio)*size,size/2-configuration.options.leftEyeBrowRightYPositionToSizeRatio*size);context.stroke();context.closePath();context.restore()}if(this.leftEndAngle==0){eyesSizeLower=eyesSizeUpper}if(this.rightEndAngle==0){eyesSizeUpper=eyesSizeLower}context.beginPath();context.moveTo(size/2-configuration.options.eyeXPositionToSizeRatio*size,size/2-configuration.options.eyeYPositionToSizeRatio*size);context.closePath();context.save();context.fillStyle=configuration.options.eyesFillColor;scaleWidth=1;scaleHeight=eyesSizeLower*configuration.options.eyeHeightToWidthRatio;if(configuration.options.eyesSizeScaled){scaleWidth=eyesSizeLower}context.scale(scaleWidth,scaleHeight);context.arc((size/2-configuration.options.eyeXPositionToSizeRatio*size)/scaleWidth,(size/2-configuration.options.eyeYPositionToSizeRatio*size)/scaleHeight,configuration.options.eyeWidthToSizeRatio*size,0,Math.PI*2,true);context.fill();context.restore();context.beginPath();context.moveTo(size/2+configuration.options.eyeXPositionToSizeRatio*size,size/2-configuration.options.eyeYPositionToSizeRatio*size);context.closePath();context.save();context.fillStyle=configuration.options.eyesFillColor;scaleWidth=1;scaleHeight=eyesSizeUpper*configuration.options.eyeHeightToWidthRatio;if(configuration.options.eyesSizeScaled){scaleWidth=eyesSizeUpper}context.scale(scaleWidth,scaleHeight);context.arc((size/2+configuration.options.eyeXPositionToSizeRatio*size)/scaleWidth,(size/2-configuration.options.eyeYPositionToSizeRatio*size)/scaleHeight,configuration.options.eyeWidthToSizeRatio*size,0,Math.PI*2,true);context.fill();context.restore()}}function ConfigurationManager(parentObject,userConfiguration){this.parentObject=parentObject;this.canvas=parentObject.canvas;this.element=parentObject.element;this.canvasAlt={};this.configuration={};this.fuzzy={};this.sliderThumbWidth=10;this.rightButtonDown=false;this.canvasDisplayed=true;this.canvasAltDisplayed=true;var self=this;this.empty=function(data){if(typeof data=="number"||typeof data=="boolean"){return false}if(typeof data=="undefined"||data===null){return true}if(typeof data.length!="undefined"){return data.length==0}var count=0;for(var i in data){if(data.hasOwnProperty(i)){count++}}return count==0};this.render=function(){if(typeof self.parentObject.render==="undefined"){var xFuzzy=this.fuzzy.fuzzyInputProcessing();if(this.configuration.options.impreciseInput){if(this.configuration.options.displayLowerBoundOnly){this.parentObject.draw(xFuzzy[0],this.canvas)}else if(this.configuration.options.displayUpperBoundOnly){this.parentObject.draw(xFuzzy[1],this.canvas)}else{this.parentObject.draw(xFuzzy[0],this.canvas);this.parentObject.draw(xFuzzy[1],this.canvasAlt)}}else{this.parentObject.draw(xFuzzy,this.canvas)}if(this.fuzzy.canvasFuzzy!==null){this.fuzzy.drawFuzzyPartition()}}else{self.parentObject.render()}};this.addEventlisteners=function(){window.addEventListener("load",function(){self.render()},true);this.element.addEventListener("input",function(){self.render()},false);this.element.addEventListener("change",function(){self.render()},true);this.parentObject.canvas.addEventListener("dblclick",function(){self.doubleClickEventManager()},false);if(this.configuration.options.impreciseInput||this.parentObject instanceof BiEmoticon){if(!this.empty(this.configuration.options.sliderThumbWidth)){this.sliderThumbWidth=this.configuration.options.sliderThumbWidth}var style=document.createElement("style");style.setAttribute("id","sliderStyle_"+this.element.id);document.head.append(style);document.getElementById("sliderStyle_"+this.element.id).innerHTML="."+this.element.id+"::-moz-range-thumb {width: "+this.sliderThumbWidth+"%;}";document.getElementById("sliderStyle_"+this.element.id).innerHTML+="."+this.element.id+"::-webkit-slider-thumb {width: "+this.sliderThumbWidth+"%;}";document.getElementById("sliderStyle_"+this.element.id).innerHTML+="."+this.element.id+"::-ms-thumb {width: "+Math.round(this.sliderThumbWidth*this.element.offsetWidth/100)+"px;}";this.element.classList.add(this.element.id);if(this.element.addEventListener){this.element.addEventListener("mousewheel",function(event){self.wheelEventManager(event)},false);this.element.addEventListener("wheel",function(event){self.wheelEventManager(event)},false)}else{this.element.attachEvent("onmousewheel",function(event){self.wheelEventManager(event)})}this.element.addEventListener("mousedown",function(event){self.rightButtonDown=true});this.element.addEventListener("mouseup",function(event){self.rightButtonDown=false});this.canvas.addEventListener("click",function(){self.clickEventManager(event,self.canvas)},false);if(this.configuration.options.impreciseInput){this.canvasAlt.addEventListener("click",function(){self.clickEventManager(event,self.canvasAlt)},false);this.canvasAlt.addEventListener("dblclick",function(){self.doubleClickEventManager()},false)}}};this.wheelEventManager=function(event){event.preventDefault();if(this.rightButtonDown===true){var style=document.getElementById("sliderStyle_"+this.element.id);if(event.deltaY>0){if(parseInt(this.element.value)<100-this.sliderThumbWidth/2){this.element.value=parseInt(this.element.value)+1;if(this.sliderThumbWidth>1){this.sliderThumbWidth-=1}}}else{this.element.value=parseInt(this.element.value)-1;if(this.sliderThumbWidth<100){this.sliderThumbWidth+=1}}style.innerHTML="."+this.element.id+"::-moz-range-thumb {width: "+this.sliderThumbWidth+"%;}";style.innerHTML+="."+this.element.id+"::-webkit-slider-thumb {width: "+this.sliderThumbWidth+"%;}";style.innerHTML+="."+this.element.id+"::-ms-thumb {width: "+this.sliderThumbWidth*this.element.offsetWidth/100+"px;}\n"}self.render()};this.clickEventManager=function(event,canvas){var scrollY=window.scrollY;if(typeof scrollY==="undefined"){scrollY=document.documentElement.scrollTop}var x=event.pageX-canvas.getBoundingClientRect().left;var y=event.pageY-canvas.getBoundingClientRect().top-scrollY;var size=canvas.width;var distance=(x-size/2)*(x-size/2)+(-y+size/2)*(-y+size/2);if(event.shiftKey&&this.configuration.options.impreciseInput){if(canvas==this.canvasAlt){if(this.canvasDisplayed){this.canvas.style.display="none"}else{this.canvas.style.display="initial"}this.canvasDisplayed=!this.canvasDisplayed}else{if(this.canvasAltDisplayed){this.canvasAlt.style.display="none"}else{this.canvasAlt.style.display="initial"}this.canvasAltDisplayed=!this.canvasAltDisplayed}}else{if(distance<size*size/4){this.parentObject.leftStartAngle=0;this.parentObject.leftEndAngle=2*Math.PI;this.parentObject.rightStartAngle=Math.PI/2;this.parentObject.rightEndAngle=-Math.PI/2;this.parentObject.dashSize=3}else{if(x<size/2){this.parentObject.leftStartAngle=0;this.parentObject.leftEndAngle=2*Math.PI;this.parentObject.rightStartAngle=0;this.parentObject.rightEndAngle=0;this.parentObject.dashSize=0}else{this.parentObject.leftStartAngle=0;this.parentObject.leftEndAngle=0;this.parentObject.rightStartAngle=0;this.parentObject.rightEndAngle=2*Math.PI;this.parentObject.dashSize=0}}}self.render()};this.doubleClickEventManager=function(){if(self.fuzzy.canvasFuzzy===null){self.fuzzy.drawFuzzyPartition()}else{self.canvas.parentNode.removeChild(self.fuzzy.canvasFuzzy);self.fuzzy.canvasFuzzy=null}};this.update=function(userConfiguration){if(this.empty(userConfiguration)){this.configuration=this.parentObject.defaultConfiguration}else{this.configuration=Object.assign({},this.parentObject.defaultConfiguration,userConfiguration);this.configuration.options=Object.assign({},this.parentObject.defaultConfiguration.options,userConfiguration.options)}};this.polyfills=function(){if(typeof Object.assign!="function"){Object.defineProperty(Object,"assign",{value:function assign(target,varArgs){"use strict";if(target==null){throw new TypeError("Cannot convert undefined or null to object")}var to=Object(target);for(var index=1;index<arguments.length;index++){var nextSource=arguments[index];if(nextSource!=null){for(var nextKey in nextSource){if(Object.prototype.hasOwnProperty.call(nextSource,nextKey)){to[nextKey]=nextSource[nextKey]}}}}return to},writable:true,configurable:true})}if(!Array.prototype.findIndex){Object.defineProperty(Array.prototype,"findIndex",{value:function(predicate){if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var thisArg=arguments[1];var k=0;while(k<len){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o)){return k}k++}return-1},configurable:true,writable:true})}};this.update(userConfiguration);this.fuzzy=new Fuzzy(this);if(this.configuration.options.impreciseInput){this.canvasAlt=document.createElement("canvas");this.canvasAlt.id=this.canvas.id+"Alt";this.canvasAlt.width=this.canvas.width;this.canvasAlt.height=this.canvas.height;this.canvasAlt.classList.add("alt");this.canvas.parentNode.insertBefore(this.canvasAlt,this.canvas.nextSibling)}this.addEventlisteners();this.polyfills()}function Fuzzy(parentObject){this.parentObject=parentObject;this.canvasFuzzy=document.getElementById(parentObject.canvas.id+"Fuzzy");this.fuzzyInput=null;this.coverageInterval=null;this.drawFuzzyPartition=function(){var fuzzyPartition=this.parentObject.configuration.fuzzyPartition;if(this.canvasFuzzy===null){this.canvasFuzzy=document.createElement("canvas");this.canvasFuzzy.id=this.parentObject.canvas.id+"Fuzzy";if(this.parentObject.element.type=="range"){this.canvasFuzzy.width=this.parentObject.element.offsetWidth}else{this.canvasFuzzy.width=this.parentObject.configuration.options.canvasFuzzyWidth}this.canvasFuzzy.height=this.parentObject.configuration.options.canvasFuzzyHeight;this.canvasFuzzy.classList.add("fuzzy");if(this.parentObject.configuration.options.impreciseInput){this.parentObject.canvas.parentNode.insertBefore(this.canvasFuzzy,this.parentObject.canvasAlt.nextSibling)}else{this.parentObject.canvas.parentNode.insertBefore(this.canvasFuzzy,this.parentObject.canvas.nextSibling)}}var lowerBound=fuzzyPartition[0].bounds[0];var upperBound=fuzzyPartition[0].bounds[3];for(var i=1;i<fuzzyPartition.length;i++){if(fuzzyPartition[i].bounds[0]<lowerBound){lowerBound=fuzzyPartition[i].bounds[0]}if(fuzzyPartition[i].bounds[3]>upperBound){upperBound=fuzzyPartition[i].bounds[3]}}var context=this.canvasFuzzy.getContext("2d");var coeff=this.canvasFuzzy.width/(upperBound-lowerBound);var heightOffset=10;if(context!==null){context.clearRect(0,0,this.canvasFuzzy.width,this.canvasFuzzy.height);if(Array.isArray(this.fuzzyInput)){heightOffset=20}for(var i=0;i<fuzzyPartition.length;i++){context.save();context.beginPath();context.strokeStyle="rgb("+fuzzyPartition[i].color[0]+","+fuzzyPartition[i].color[1]+","+fuzzyPartition[i].color[2]+")";context.moveTo(coeff*(fuzzyPartition[i].bounds[0]-lowerBound),this.canvasFuzzy.height-10);context.lineTo(coeff*(fuzzyPartition[i].bounds[1]-lowerBound),heightOffset);context.lineTo(coeff*(fuzzyPartition[i].bounds[2]-lowerBound),heightOffset);context.lineTo(coeff*(fuzzyPartition[i].bounds[3]-lowerBound),this.canvasFuzzy.height-10);context.closePath();context.stroke();context.restore()}if(this.fuzzyInput!==null){context.save();context.beginPath();context.setLineDash([3,3]);if(Array.isArray(this.fuzzyInput)){context.moveTo(coeff*(this.fuzzyInput[0]-lowerBound),this.canvasFuzzy.height-10);context.lineTo(coeff*(this.fuzzyInput[1]-lowerBound),heightOffset);context.lineTo(coeff*(this.fuzzyInput[3]-lowerBound),this.canvasFuzzy.height-10);context.stroke();if(this.coverageInterval!==null){context.save();context.beginPath();context.setLineDash([3,1]);context.strokeStyle="rgb(0, 0, 255)";context.moveTo(coeff*(this.coverageInterval[0]-lowerBound),this.canvasFuzzy.height-10);context.lineTo(coeff*(this.coverageInterval[0]-lowerBound),heightOffset);context.lineTo(coeff*(this.coverageInterval[1]-lowerBound),heightOffset);context.lineTo(coeff*(this.coverageInterval[1]-lowerBound),this.canvasFuzzy.height-10);context.font="bold 15px Arial";context.textAlign="center";context.fillText("Level of confidence = "+this.levelOfConfidence.toFixed(2),this.canvasFuzzy.width/2,15);context.stroke();context.closePath();context.restore()}}else{context.moveTo(coeff*(this.fuzzyInput-lowerBound),this.canvasFuzzy.height-10);context.lineTo(coeff*(this.fuzzyInput-lowerBound),heightOffset);context.stroke()}context.closePath();context.restore()}}};this.fuzzyInputProcessing=function(){if(this.parentObject.configuration.options.impreciseInput||this.parentObject.parentObject instanceof BiEmoticon){var sliderThumbWidth=this.parentObject.sliderThumbWidth;var x=(100-sliderThumbWidth)*this.parentObject.element.value/100+sliderThumbWidth/2;var xFuzzy=[];this.fuzzyInput=[x-sliderThumbWidth/2,x,x,x+sliderThumbWidth/2];var xFuzzy=this.fuzzyLowerDescription(this.fuzzyInput,this.parentObject.configuration.fuzzyPartition);var LowerDescriptionMax=0;for(var i=0;i<xFuzzy.length;i++){LowerDescriptionMax=Math.max(LowerDescriptionMax,xFuzzy[i].value)}var cut=[this.fuzzyInput[1]-sliderThumbWidth*(1-LowerDescriptionMax)/2,this.fuzzyInput[1]+sliderThumbWidth*(1-LowerDescriptionMax)/2];this.coverageInterval=cut;this.levelOfConfidence=LowerDescriptionMax;return[this.fuzzyDescription(cut[0],this.parentObject.configuration.fuzzyPartition),this.fuzzyDescription(cut[1],this.parentObject.configuration.fuzzyPartition)]}else{this.fuzzyInput=this.parentObject.element.value;return this.fuzzyDescription(this.fuzzyInput,this.parentObject.configuration.fuzzyPartition)}};this.fuzzyDescription=function(x,membershipFunctions){var result=[];for(i=0;i<membershipFunctions.length;i++){result[i]={value:this.gradeOfMembership(membershipFunctions[i],x),label:membershipFunctions[i].label}}return result};this.fuzzyLowerDescription=function(x,membershipFunctions){var result=[];for(i=0;i<membershipFunctions.length;i++){result[i]={value:this.gradeOfMembershipTrapezoidalInput(membershipFunctions[i],x),label:membershipFunctions[i].label}}return result};this.gradeOfMembershipTrapezoidalInput=function(membershipFunction,x){var g1=x[0];var mg1=x[1];var md1=x[2];var d1=x[3];var result=1;var u;g2=membershipFunction.bounds[0];mg2=membershipFunction.bounds[1];md2=membershipFunction.bounds[2];d2=membershipFunction.bounds[3];if(g1==mg1&&g1==md1&&g1==d1)return this.gradeOfMembership(membershipFunction,g1);var result=1;if(mg1>d2||md1<g2){return 0}if(mg2<=g1&&d1<=md2){return 1}if(mg2==g2){if(g1<mg2&&mg2<=mg1){result=Math.min(result,(g2-mg1)/(mg1-g1))}}else{if(mg1==g1){u=g1}else{u=((mg2-g2)*mg1+(mg1-g1)*g2)/(mg2-g2+(mg1-g1))}if(g2<=u&&u<=mg2){result=Math.min(result,(u-g2)/(mg2-g2))}}if(md2==d2){if(g1<=md2&&md2<=mg1){result=Math.min(result,(d2-mg1)/(mg1-g1))}}else{if(mg1==g1){u=g1}else{u=((md2-d2)*mg1+(mg1-g1)*d2)/(md2-d2+(mg1-g1))}if(md2-d2+(mg1-g1)==0){if(g1==md2&&mg1==d2){return 0}}else{if(md2<=u&&u<=d2){result=Math.min(result,(u-d2)/(md2-d2))}}}if(mg2==g2){if(md1<=mg2&&mg2<=d1){result=Math.min(result,(g2-md1)/(d1-md1))}}else{if(md1==d1){u=d1}else{u=((mg2-g2)*md1+(md1-d1)*g2)/(mg2-g2+(md1-d1))}if(mg2-g2+(md1-d1)==0){if(g2==md1&&mg2==d1){return 0}}else{if(g2<=u&&u<=mg2){result=Math.min(result,(u-g2)/(mg2-g2))}}}if(md2==d2){if(md1<=md2&&md2<d1){result=Math.min(result,(d2-md1)/(d1-md1))}}else{if(md1==d1){u=d1}else{u=((md2-d2)*md1+(md1-d1)*d2)/(md2-d2+(md1-d1))}if(md2<u&&u<=d2){result=Math.min(result,(u-d2)/(md2-d2))}}return result};this.gradeOfMembership=function(membershipFunction,x){if(x<membershipFunction.bounds[0]){return 0}else if(x<membershipFunction.bounds[1]){return(x-membershipFunction.bounds[0])/(membershipFunction.bounds[1]-membershipFunction.bounds[0])}else if(x<membershipFunction.bounds[2]){return 1}else if(x<membershipFunction.bounds[3]){return(membershipFunction.bounds[3]-x)/(membershipFunction.bounds[3]-membershipFunction.bounds[2])}else if(membershipFunction.bounds[2]==membershipFunction.bounds[3]){return 1}else{return 0}};this.defuzzify=function(x,prototypes){var k;var numerator=[];var denominator=[];var result=[];if(Array.isArray(prototypes[0].prototype)){for(j=0;j<prototypes[0].prototype.length;j++){numerator[j]=0;denominator[j]=0}}else{numerator[0]=0;denominator[0]=0}for(i=0;i<x.length;i++){k=prototypes.findIndex(this.checkLabel,x[i]);if(Array.isArray(prototypes[k].prototype)){for(j=0;j<prototypes[0].prototype.length;j++){numerator[j]=numerator[j]+x[i].value*prototypes[k].prototype[j];denominator[j]=denominator[j]+x[i].value}}else{numerator[0]=numerator[0]+x[i].value*prototypes[k].prototype;denominator[0]=denominator[0]+x[i].value}}if(Array.isArray(prototypes[0].prototype)){for(j=0;j<prototypes[0].prototype.length;j++){result[j]=numerator[j]/denominator[j]}return result}else{result[0]=numerator[0]/denominator[0];return result[0]}};this.checkLabel=function(object){return object.label==this.label}}